<!DOCTYPE html>
<html lang="en">
    {% capture TemplateType %}
        {% if Type == 'INVOICE' %}
            Invoice
        {% else %}
            Receipt
        {% endif %}
    {% endcapture %}
    <head>
        <meta charset="UTF-8">

        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>{{TemplateType}}</title>

        <style>
            body {
                margin: 0;
                font-family: Work Sans,sans-serif;
            }

            /* root */
            .InvoiceTemplate {
                padding: 46px;
                border-top: 8px solid #9d2235;
            }

            /* header */
            .InvoiceTemplate__header {
                display: flex;
                justify-content: space-between;
            }

            .InvoiceTemplate__header svg {
                width: 46px;
            }

            /* info */
            .InvoiceTemplateInfo {
                font-size: 14px;
            }

            /* info number and dates*/
            .InvoiceTemplateInfo__numberDates {
                display: flex;
                flex-direction: column;
                gap: 4px;
                font-weight: 600;
                margin-bottom: 32px;
            }

            .InvoiceTemplateInfo__row {
                display: flex;
            }

            .InvoiceTemplateInfo__leftCol {
                display: block;
                width: 130px;
            }

            /* info address and bill to*/
            .InvoiceTemplateInfo__addressBillTo {
                display: flex;
                column-gap: 64px;
                row-gap: 32px;
                width: 100%;
                max-width: 700px;
                justify-content: space-between;
                margin-bottom: 46px;
            }

            .InvoiceTemplateInfo__addressBillToTitle {
                font-weight: 600;
            }

            .InvoiceTemplateInfo__addressBillToList {
                display: flex;
                flex-direction: column;
                gap: 4px;
                width: 50%;
            }

            .InvoiceTemplateInfo__payLink {
                display: block;
                margin-bottom: 46px;
            }

            /* description */
            .InvoiceTemplateDescription {
                margin-bottom: 24px;
            }

            /* table */
            .InvoiceTemplateTable {
                overflow-x: auto;
                margin-bottom: 26px;
            }

            .InvoiceTemplateTable__table {
                width: 100%;
                text-align: left;
                border-collapse: collapse;
                min-width: 440px;
            }

            .InvoiceTemplateTable__table thead {
                border-bottom: 1px solid #000;
            }

            .InvoiceTemplateTable__table th,
            .InvoiceTemplateTable__table td {
                padding: 10px;
            }

            .InvoiceTemplateTable__table td {
                text-wrap: nowrap;
                vertical-align: top;
            }

            .InvoiceTemplateTable__table th:first-child,
            .InvoiceTemplateTable__table td:first-child {
                padding-left: 0;
            }

            .InvoiceTemplateTable__table th:last-child,
            .InvoiceTemplateTable__table td:last-child {
                padding-right: 0;
                text-align: right;
            }

            .InvoiceTemplateTable__table thead th {
                font-weight: normal;
                font-size: 12px;
            }

            .InvoiceTemplateTable__description {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .InvoiceTemplateTable__descriptionListWrap {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }

            .InvoiceTemplateTable__descriptionList {
                margin: 0;
                padding-left: 24px;
            }

            /* totals */
            .InvoiceTemplateTotals {
                display: flex;
                flex-direction: column;
                margin-left: auto;
                width: 100%;
                max-width: 420px;
                margin-bottom: 32px;
            }

            .InvoiceTemplateTotals__row {
                display: flex;
                justify-content: space-between;
                padding: 10px 0;
                border-bottom: 1px solid #ebebeb;
            }

            .InvoiceTemplateTotals__row:last-child {
                border: none;
            }

            .InvoiceTemplateTotals__row_bold {
                font-weight: 600;
            }

            /* footer */
            .InvoiceTemplateFooter__footnote {
                display: block;
                margin-bottom: 32px;
            }

            .InvoiceTemplateFooter__bottom {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            @media screen and (max-width: 576px) {
                .InvoiceTemplate {
                    padding: 12px;
                }
            }

            @media screen and (max-width: 400px) {
                .InvoiceTemplateInfo__addressBillTo {
                    flex-direction: column;
                }

                .InvoiceTemplateInfo__addressBillToList {
                    width: 100%;
                }

                .InvoiceTemplateInfo__row {
                    flex-direction: column;
                    gap: 4px;
                }

                .InvoiceTemplateInfo__numberDates {
                    gap: 12px;
                }
            }
        </style>
    </head>
    <body>
        <div class="InvoiceTemplate">
            <header class="InvoiceTemplate__header">
                <h1>
                    {{TemplateType}}
                </h1>

                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 58.2 44.9"
                >
                    <path
                        d="M58.2,44.9l-11-18.1a14.09,14.09,0,0,0,5.3-4.4,13.57,13.57,0,0,0,2.3-8c0-4.5-1.6-8.1-4.7-10.6S42.9,0,37.5,0H0V44.9H58.2ZM45.7,42.5h0m-7.1-40c4.3.1,7.7,1.2,10,3.2a10.65,10.65,0,0,1,3.8,8.7,11.38,11.38,0,0,1-1.9,6.7A11.79,11.79,0,0,1,45,25.2l-1.4.5L53.8,42.5H45.7l-9.6-16a13.53,13.53,0,0,0,6.3-4.8,13.38,13.38,0,0,0,2.2-7.8c0-4.4-1.5-7.8-4.4-10.2a16.67,16.67,0,0,0-1.6-1.2h0M12,2.5h0ZM8.6,42.4V33.2H5.7v9.2H2.9V2.5H27.6c4.6,0,8.1,1,10.5,2.9s3.6,4.8,3.6,8.5a10.9,10.9,0,0,1-2.4,7.3,13.47,13.47,0,0,1-7.2,3.9L42.4,42.4H26.5V9.4H23.6V42.5h-3V16H17.7V42.4h-3V25.1H11.8V42.4H8.6Z"
                        style="fill: #9d2235"
                    />
                </svg>
            </header>

            <div class="InvoiceTemplateInfo">
                <div class="InvoiceTemplateInfo__numberDates">
                    <div class="InvoiceTemplateInfo__row">
                        <span class="InvoiceTemplateInfo__leftCol">
                            Invoice number&#58;
                        </span>

                        <span>
                            {{Invoice.Number | default: 'N/A'}}
                        </span>
                    </div>
                    {% if Type == 'RECEIPT' %}
                        <div class="InvoiceTemplateInfo__row">
                            <span class="InvoiceTemplateInfo__leftCol">
                                Receipt number&#58;
                            </span>

                            <span>
                                {{Invoice.ReceiptNumber}}
                            </span>
                        </div>
                    {% endif %}

                    {% if Invoice.StatusTransitions.FinalizedAt %}
                        <div class="InvoiceTemplateInfo__row">
                            <span class="InvoiceTemplateInfo__leftCol">
                                Date of issue&#58;
                            </span>

                            <span>
                                {{Invoice.StatusTransitions.FinalizedAt | format_date: 'MMMM d, yyyy'}}
                            </span>
                        </div>
                    {% endif %}

                    {% if Type == 'RECEIPT' %}
                        <div class="InvoiceTemplateInfo__row">
                            <span class="InvoiceTemplateInfo__leftCol">
                                Date paid&#58;
                            </span>

                            <span>
                                {{Invoice.StatusTransitions.PaidAt | format_date: 'MMMM d, yyyy' | default: 'N/A'}}
                            </span>
                        </div>
                    {% endif %}

                    {% if Type == 'INVOICE' and Invoice.DueDate %}
                        <div class="InvoiceTemplateInfo__row">
                            <span class="InvoiceTemplateInfo__leftCol">
                                Date due&#58;
                            </span>

                            <span>
                                {{Invoice.DueDate | format_date: 'MMMM d, yyyy' | default: 'N/A'}}
                            </span>
                        </div>
                    {% endif %}

                    {% if Type == 'RECEIPT' and Invoice.Charge.PaymentMethodDetails %}
                        <div class="InvoiceTemplateInfo__row">
                            <span class="InvoiceTemplateInfo__leftCol">
                                Payment method&#58;
                            </span>

                            <span>
                                {{ Invoice.Charge.PaymentMethodDetails | display_charge_payment_method }}
                            </span>
                        </div>
                    {% endif %}
                </div>

                <div class="InvoiceTemplateInfo__addressBillTo">
                    <div class="InvoiceTemplateInfo__addressBillToList">
                        {% if Invoice.AccountName %}
                            <span class="InvoiceTemplateInfo__addressBillToTitle">
                                Rosenberg Research & Associates Inc.
                            </span>
                        {% endif %}

                        <span>
                            3080 Yonge Street
                        </span>

                        <span>
                            Suite 6060
                        </span>

                        <span>
                            Toronto Ontario M4N 3N1
                        </span>

                        <span>
                            Canada
                        </span>

                        <span>
                            +1 416-583-5566
                        </span>

                        <span>
                            information@rosenbergresearch.com
                        </span>

                    </div>

                    <div class="InvoiceTemplateInfo__addressBillToList">
                        <span class="InvoiceTemplateInfo__addressBillToTitle">
                            Bill To
                        </span>

                        {% if BillTo.FullName %}
                            <span>
                                {{BillTo.FullName}}
                            </span>
                        {% endif %}

                        {% if BillTo.BillingAddress %}
                            <span>
                                {{BillTo.BillingAddress}}
                            </span>
                        {% endif %}

                        {% if BillTo.Phone %}
                            <span>
                                {{BillTo.Phone}}
                            </span>
                        {% endif %}

                        {% if BillTo.Email %}
                            <span>
                                {{BillTo.Email}}
                            </span>
                        {% endif %}
                    </div>
                </div>

                <h2>
                    {{Invoice.AmountDue | divided_by: 100.0 | format_number: 'C2', 'en'}} USD

                    {% if Invoice.Paid %}
                        paid on {{Invoice.StatusTransitions.PaidAt | format_date: 'MMMM d, yyyy'}}
                    {% else %}
                        due {{Invoice.DueDate | format_date: 'MMMM d, yyyy'}}
                    {% endif %}
                </h2>

                {% if Invoice.Status == "open" %}
                    <a
                        class="InvoiceTemplateInfo__payLink"
                        href="{{HostedUrl}}"
                        target="_blank"
                    >
                        Pay online
                    </a>
                {% endif %}

                {% if Invoice.Description %}
                    <div class="InvoiceTemplateDescription">
                        {{Invoice.Description}}
                    </div>
                {% endif %}

                <div class="InvoiceTemplateTable">
                    <table class="InvoiceTemplateTable__table">
                        <thead>
                            <tr>
                                <th>
                                    Description
                                </th>

                                <th>
                                    Qty
                                </th>

                                <th>
                                    Unit price
                                </th>

                                <th>
                                    Tax
                                </th>

                                <th>
                                    Amount
                                </th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for Item in Invoice.Lines %}
                                {% assign ItemCategories = Item.Price.Id | categories %}

                                <tr>
                                    <td>
                                        <div class="InvoiceTemplateTable__description">
                                            <span>{{Item.Description | default: 'N/A'}}</span>

                                            {% if ItemCategories %}
                                                <div class="InvoiceTemplateTable__descriptionListWrap">
                                                    <span>Included:</span>

                                                    <ul class="InvoiceTemplateTable__descriptionList">
                                                        {% for ItemCategory in ItemCategories %}
                                                            <li>{{ItemCategory.NameSingular}}</li>
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </td>

                                    <td>{{Item.Quantity | default: 'N/A'}}</td>

                                    <td>
                                        {% if Item.UnitAmountExcludingTax %}
                                            {{Item.UnitAmountExcludingTax | divided_by: 100.0 | format_number: 'C2', 'en'}}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>

                                    <td>
                                        {% assign current_tax_rate = Invoice.DefaultTaxRates | where: 'Id', Item.TaxAmounts[0].TaxRateId %}

                                        {% if current_tax_rate[0].Percentage %}
                                            {{current_tax_rate[0].Percentage}} &#37;
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>

                                    <td>
                                        {% if Item.Amount %}
                                            {{Item.Amount | divided_by: 100.0 | format_number: 'C2', 'en'}}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="InvoiceTemplateTotals">
                    {% if Invoice.Subtotal %}
                        <div class="InvoiceTemplateTotals__row">
                            <span>Subtotal</span>

                            <span>
                                {{Invoice.Subtotal | divided_by: 100.0 | format_number: 'C2', 'en'}}
                            </span>
                        </div>
                    {% endif %}

                    {% if Invoice.TotalDiscountAmounts[0].Amount %}
                        <div class="InvoiceTemplateTotals__row">
                            <span>
                                {{Invoice.TotalDiscountAmounts[0].Discount.Coupon.Name}}

                                &#40;{{Invoice.TotalDiscountAmounts[0].Discount.Coupon.PercentOff}}&#37; off&#41;
                            </span>

                            <span>
                                &#45;{{Invoice.TotalDiscountAmounts[0].Amount | divided_by: 100.0 | format_number: 'C2', 'en'}}
                            </span>
                        </div>
                    {% endif %}

                    <div class="InvoiceTemplateTotals__row">
                        <span>Total excluding tax</span>

                        <span>
                            {{Invoice.TotalExcludingTax | divided_by: 100.0 | format_number: 'C2', 'en'}}
                        </span>
                    </div>

                    <div class="InvoiceTemplateTotals__row">
                        <span>TAX &#40;{{Invoice.DefaultTaxRates[0].Percentage}}&#37; on &#36;{{Invoice.TotalExcludingTax | divided_by: 100 | format_number: 'N2'}}&#41;</span>

                        <span>
                            {{Invoice.Tax | divided_by: 100.0 | format_number: 'C2', 'en'}}
                        </span>
                    </div>

                    <div class="InvoiceTemplateTotals__row">
                        <span>Total</span>

                        <span>
                            {{Invoice.Total | divided_by: 100.0 | format_number: 'C2', 'en'}}
                        </span>
                    </div>

                    {% if Invoice.StartingBalance %}
                        <div class="InvoiceTemplateTotals__row">
                            <span>Applied Balance</span>

                            <span>
                                {{Invoice.StartingBalance | divided_by: 100.0 | format_number: 'C2', 'en'}}
                            </span>
                        </div>
                    {% endif %}

                    <div class="InvoiceTemplateTotals__row InvoiceTemplateTotals__row_bold">
                        {% if Type == "INVOICE" %}
                        <span>Amount due</span>

                        <span>
                            {{Invoice.AmountDue | divided_by: 100.0 | format_number: 'C2', 'en'}} USD
                        </span>
                        {% else %}
                        <span>Amount paid</span>

                        <span>
                            {{Invoice.AmountPaid | divided_by: 100.0 | format_number: 'C2', 'en'}} USD
                        </span>
                        {% endif %}
                    </div>
                </div>

                {% if Invoice.Footer %}
                    <footer>
                        {{Invoice.Footer | raw}}
                    </footer>
                {% endif %}
            </div>
        </div>
    </body>
</html>
